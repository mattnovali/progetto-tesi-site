(function(){"use strict";var e={5018:function(e,t,n){var o=n(5130),i=n(6768);function r(e,t,n,o,r,s){const a=(0,i.g2)("router-view");return(0,i.uX)(),(0,i.Wv)(a)}var s={data(){return{wakeLock:null}},async mounted(){if("wakeLock"in navigator)try{this.wakeLock=await navigator.wakeLock.request("screen")}catch(e){console.warn("Wake Lock non disponibile:",e)}},beforeUnmount(){this.wakeLock&&this.wakeLock.release&&this.wakeLock.release()}},a=n(1241);const l=(0,a.A)(s,[["render",r]]);var d=l,c=n(4458);(0,c.k)("/service-worker.js",{ready(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered(){console.log("Service worker has been registered.")},cached(){console.log("Content has been cached for offline use.")},updatefound(){console.log("New content is downloading.")},updated(){console.log("New content is available; please refresh.")},offline(){console.log("No internet connection found. App is running in offline mode.")},error(e){console.error("Error during service worker registration:",e)}});var u=n(1387);const h={class:"home"};function v(e,t,n,o,r,s){return(0,i.uX)(),(0,i.CE)("div",h,[(0,i.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>s.triggerCamera&&s.triggerCamera(...e))},"Record Video"),(0,i.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>s.triggerVideoSelection&&s.triggerVideoSelection(...e))},"Analyze Video"),t[4]||(t[4]=(0,i.Lk)("button",null,"Real Time Analyzer",-1)),t[5]||(t[5]=(0,i.Lk)("button",null,"Track",-1)),(0,i.Lk)("input",{ref:"cameraInput",type:"file",accept:"video/*",capture:"environment",style:{display:"none"},onChange:t[2]||(t[2]=(...e)=>s.handleVideoSelected&&s.handleVideoSelected(...e))},null,544),(0,i.Lk)("input",{ref:"videoInput",type:"file",accept:"video/*",style:{display:"none"},onChange:t[3]||(t[3]=(...e)=>s.handleVideoSelected&&s.handleVideoSelected(...e))},null,544)])}n(4114);var f={name:"HomeView",components:{},methods:{triggerCamera(){this.$refs.cameraInput.click()},triggerVideoSelection(){this.$refs.videoInput.click()},handleVideoSelected(e){const t=e.target,n=t.files[0],o=["video/mp4","video/webm","video/ogg"];if(t.value="",n){if(!o.includes(n.type))return void alert(`Formato non supportato: ${n.type||"sconosciuto"}.\nFormati consentiti: ${o.join(", ")}`);const e=URL.createObjectURL(n);this.$router.push({name:"selected-video",query:{videoUrl:e}})}}},mounted(){this.$refs.videoInput&&(this.$refs.videoInput.value="")}};const p=(0,a.A)(f,[["render",v],["__scopeId","data-v-b7c94200"]]);var m=p,g=n(4232);const k={class:"selected-video-view"},y=["src"],w={key:1,class:"progress-container"},b=["value"],L={class:"navigation-buttons"};function C(e,t,n,r,s,a){return(0,i.uX)(),(0,i.CE)("div",k,[(0,i.Lk)("label",null,[t[6]||(t[6]=(0,i.eW)("Model: ")),(0,i.bo)((0,i.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.selectedModel=e)},t[5]||(t[5]=[(0,i.Lk)("option",{value:"pose_landmarker_full.task"},"Full",-1),(0,i.Lk)("option",{value:"pose_landmarker_heavy.task"},"Heavy",-1),(0,i.Lk)("option",{value:"pose_landmarker_lite.task"},"Lite",-1)]),512),[[o.u1,s.selectedModel]])]),s.videoUrl?((0,i.uX)(),(0,i.CE)("video",{src:s.videoUrl,controls:"",autoplay:"",loop:"",key:s.videoUrl},null,8,y)):(0,i.Q3)("",!0),s.analyzing?((0,i.uX)(),(0,i.CE)("div",w,[(0,i.Lk)("label",null,"Analisi in corso: "+(0,g.v_)(s.analysisProgress)+"%",1),(0,i.Lk)("progress",{value:s.analysisProgress,max:"100"},null,8,b)])):(0,i.Q3)("",!0),(0,i.Lk)("div",L,[(0,i.Lk)("button",{onClick:t[1]||(t[1]=(...e)=>a.goBack&&a.goBack(...e))},"Back"),(0,i.Lk)("button",{onClick:t[2]||(t[2]=(...e)=>a.triggerVideoSelection&&a.triggerVideoSelection(...e))},"Change Video"),(0,i.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>a.analyzeAndGoToResults&&a.analyzeAndGoToResults(...e))},"Analyze")]),(0,i.Lk)("input",{ref:"videoInput",type:"file",accept:"video/*",style:{display:"none"},onChange:t[4]||(t[4]=(...e)=>a.handleVideoSelected&&a.handleVideoSelected(...e))},null,544)])}var E=n(485),U={name:"SelectedVideoView",data(){return{videoUrl:this.$route.query.videoUrl||null,analyzing:!1,analysisProgress:0,selectedModel:"pose_landmarker_heavy.task",landmarkerInstance:null,videoElement:null}},methods:{triggerVideoSelection(){this.$refs.videoInput&&(this.$refs.videoInput.value="",this.$nextTick((()=>{this.$refs.videoInput.click()})))},handleVideoSelected(e){const t=e.target.files[0],n=["video/mp4","video/webm","video/ogg"];if(t){if(!n.includes(t.type))return void alert(`Unsupported video format: ${t.type||"unknown"}.\nSupported formats: ${n.join(", ")}`);this.videoUrl&&URL.revokeObjectURL(this.videoUrl);const e=URL.createObjectURL(t);this.videoUrl=e}},goBack(){this.$router.go(-1)},async analyzeAndGoToResults(){if(!this.videoUrl)return void alert("Select a video first.");try{await fetch("https://www.google.com",{mode:"no-cors"})}catch(t){return void alert("You are offline")}this.analyzing=!0;const e=await this.analyzeVideo(this.videoUrl);this.analyzing=!1,this.$router.push({name:"analysis-results",state:{results:e,videoUrl:this.videoUrl}})},async analyzeVideo(e){const t=await E.Ps.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm"),n=await E.Pi.createFromOptions(t,{baseOptions:{modelAssetPath:`/models/${this.selectedModel}`,delegate:"GPU"},runningMode:"VIDEO",numPoses:1});return this.landmarkerInstance=n,new Promise((t=>{const o=document.createElement("video");o.src=e,o.crossOrigin="anonymous",o.muted=!0,o.playsInline=!0,o.autoplay=!1,o.loop=!1,o.style.display="none",document.body.appendChild(o),this.videoElement=o;const i=[],r=10;o.onloadedmetadata=async()=>{o.currentTime=0,o.play();const e=o.duration;let s=0;const a=async()=>{if(s>e)return o.pause(),document.body.removeChild(o),void t(i);o.currentTime=s,await new Promise((e=>o.onseeked=e));const l=n.detectForVideo(o,1e3*s);i.push({time:s,poses:l}),console.log(`Frame @ ${s.toFixed(2)}s:`,l),console.log("Using model:",this.selectedModel),this.analysisProgress=Math.min(100,Math.round(s/e*100)),s+=1/r,setTimeout(a,0)};a()}}))}},beforeUnmount(){this.landmarkerInstance&&this.landmarkerInstance.close&&(this.landmarkerInstance.close(),this.landmarkerInstance=null),this.videoElement&&this.videoElement.parentNode&&(this.videoElement.pause(),this.videoElement.parentNode.removeChild(this.videoElement),this.videoElement=null),this.videoUrl=null}};const V=(0,a.A)(U,[["render",C],["__scopeId","data-v-0231d938"]]);var $=V;const I={style:{position:"relative",display:"inline-block"}},S=["src"],A={ref:"canvas",style:{position:"absolute",left:"0",top:"0","pointer-events":"none"}};function F(e,t,n,r,s,a){return(0,i.uX)(),(0,i.CE)(i.FK,null,[(0,i.Lk)("button",{onClick:t[0]||(t[0]=(...e)=>a.goBack&&a.goBack(...e))},"Back"),(0,i.Lk)("div",null,[(0,i.Lk)("label",null,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[1]||(t[1]=e=>s.showLeft=e)},null,512),[[o.lH,s.showLeft]]),(0,i.eW)(" "+(0,g.v_)(s.showLeft?"Nascondi sinistra":"Mostra sinistra"),1)]),(0,i.Lk)("label",null,[(0,i.bo)((0,i.Lk)("input",{type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=e=>s.showRight=e)},null,512),[[o.lH,s.showRight]]),(0,i.eW)(" "+(0,g.v_)(s.showRight?"Nascondi destra":"Mostra destra"),1)])]),(0,i.Lk)("div",I,[(0,i.Lk)("video",{ref:"video",src:s.videoUrl,controls:"",style:{"max-width":"100%","max-height":"50vh"}},null,8,S),(0,i.Lk)("canvas",A,null,512)])],64)}n(8111),n(7588);var O={name:"MediaPipeResultsView",data(){return{results:history.state?.results||[],videoUrl:history.state?.videoUrl||null,currentFrame:null,animationFrameId:null,showLeft:!0,showRight:!0}},mounted(){this.$refs.video.addEventListener("loadedmetadata",this.resizeCanvas),window.addEventListener("resize",this.resizeCanvas),this.$refs.video.addEventListener("play",this.startDrawing),this.$refs.video.addEventListener("pause",this.stopDrawing),this.$refs.video.addEventListener("ended",this.stopDrawing),this.$refs.video.addEventListener("timeupdate",this.drawLandmarks)},beforeUnmount(){window.removeEventListener("resize",this.resizeCanvas),this.stopDrawing(),this.$refs.video.removeEventListener("timeupdate",this.drawLandmarks)},methods:{goBack(){this.$router.back()},resizeCanvas(){const e=this.$refs.video,t=this.$refs.canvas;t.width=e.clientWidth,t.height=e.clientHeight,t.style.width=e.clientWidth+"px",t.style.height=e.clientHeight+"px"},startDrawing(){if(this.animationFrameId)return;const e=()=>{this.drawLandmarks(),this.animationFrameId=requestAnimationFrame(e)};e()},stopDrawing(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)},drawLandmarks(){const e=this.$refs.video,t=this.$refs.canvas;if(!t||!e)return;this.resizeCanvas();const n=e.currentTime;let o=null,i=1/0;for(const c of this.results){const e=Math.abs(c.time-n);e<i&&(i=e,o=c)}const r=t.getContext("2d");if(r.clearRect(0,0,t.width,t.height),!o||!o.poses?.landmarks?.length)return;r.fillStyle="red";const s=t.width,a=t.height,l=[11,13,15,17,19,21,23,25,27,29,31],d=[12,14,16,18,20,22,24,26,28,30,32];for(const c of o.poses.landmarks)c.forEach(((e,t)=>{if(this.showLeft&&l.includes(t)||this.showRight&&d.includes(t)){const t=e.x*s,n=e.y*a;r.beginPath(),r.arc(t,n,4,0,2*Math.PI),r.fill()}}))}}};const _=(0,a.A)(O,[["render",F]]);var P=_;const j=[{path:"/",name:"home",component:m},{path:"/selected-video",name:"selected-video",component:$},{path:"/analysis-results",name:"analysis-results",component:P},{path:"/about",name:"about",component:()=>n.e(594).then(n.bind(n,603))}],z=(0,u.aE)({history:(0,u.Bt)(),routes:j});var R=z;(0,o.Ef)(d).use(R).mount("#app")}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var r=t[o]={exports:{}};return e[o].call(r.exports,r,r.exports,n),r.exports}n.m=e,function(){var e=[];n.O=function(t,o,i,r){if(!o){var s=1/0;for(c=0;c<e.length;c++){o=e[c][0],i=e[c][1],r=e[c][2];for(var a=!0,l=0;l<o.length;l++)(!1&r||s>=r)&&Object.keys(n.O).every((function(e){return n.O[e](o[l])}))?o.splice(l--,1):(a=!1,r<s&&(s=r));if(a){e.splice(c--,1);var d=i();void 0!==d&&(t=d)}}return t}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[o,i,r]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(t,o){return n.f[o](e,t),t}),[]))}}(),function(){n.u=function(e){return"js/about.4f456a52.js"}}(),function(){n.miniCssF=function(e){}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){var e={},t="progetto-tesi:";n.l=function(o,i,r,s){if(e[o])e[o].push(i);else{var a,l;if(void 0!==r)for(var d=document.getElementsByTagName("script"),c=0;c<d.length;c++){var u=d[c];if(u.getAttribute("src")==o||u.getAttribute("data-webpack")==t+r){a=u;break}}a||(l=!0,a=document.createElement("script"),a.charset="utf-8",a.timeout=120,n.nc&&a.setAttribute("nonce",n.nc),a.setAttribute("data-webpack",t+r),a.src=o),e[o]=[i];var h=function(t,n){a.onerror=a.onload=null,clearTimeout(v);var i=e[o];if(delete e[o],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach((function(e){return e(n)})),t)return t(n)},v=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/"}(),function(){var e={524:0};n.f.j=function(t,o){var i=n.o(e,t)?e[t]:void 0;if(0!==i)if(i)o.push(i[2]);else{var r=new Promise((function(n,o){i=e[t]=[n,o]}));o.push(i[2]=r);var s=n.p+n.u(t),a=new Error,l=function(o){if(n.o(e,t)&&(i=e[t],0!==i&&(e[t]=void 0),i)){var r=o&&("load"===o.type?"missing":o.type),s=o&&o.target&&o.target.src;a.message="Loading chunk "+t+" failed.\n("+r+": "+s+")",a.name="ChunkLoadError",a.type=r,a.request=s,i[1](a)}};n.l(s,l,"chunk-"+t,t)}},n.O.j=function(t){return 0===e[t]};var t=function(t,o){var i,r,s=o[0],a=o[1],l=o[2],d=0;if(s.some((function(t){return 0!==e[t]}))){for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(l)var c=l(n)}for(t&&t(o);d<s.length;d++)r=s[d],n.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return n.O(c)},o=self["webpackChunkprogetto_tesi"]=self["webpackChunkprogetto_tesi"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=n.O(void 0,[504],(function(){return n(5018)}));o=n.O(o)})();
//# sourceMappingURL=app.6b58c97b.js.map